@page "/"
@using System.Net.Http.Json
@using System.Text.Json
@using StockApp.Data;
@inject HttpClient httpClient

<PageTitle>Product search page</PageTitle>

   <RadzenAutoComplete TextProperty="Name" Data=@productsName Style="margin-bottom: 20px" Change=@(args => Search(args)) />
   <RadzenDataGrid TItem="Product" Data="@products" EmptyText="@emptyText">
        <Columns>
            <RadzenDataGridColumn TItem="Product" Property="Name" Title="Name" />
            <RadzenDataGridColumn TItem="Product" Property="Seria" Title="Seria" />
            <RadzenDataGridColumn TItem="Product" Property="Quantity" Title="Quantity" />
        </Columns>
    </RadzenDataGrid>

@code {
    private IEnumerable<Product>? products;
    private IEnumerable<Product>? productsName;
    private string? emptyText;

    protected async override Task OnInitializedAsync()
    {
        productsName = await GetAllNames();
    }

    private async Task Search(object value)
    {
        HttpClient client = new HttpClient();
        if (value is not null)
        {
            var searchText = value.ToString();
            var result = await client.GetFromJsonAsync<IEnumerable<Product>>($"http://***REMOVED***:49158/api/Products/{searchText}");
            if(result is not null)
            {
                products = result;
            }
        }
    }

    private async Task<IEnumerable<Product>> GetAllNames()
    {
        HttpClient client = new HttpClient();
        var result = await client.GetFromJsonAsync<IEnumerable<Product>>($"http://***REMOVED***:49158/api/Products");
        return result ?? new List<Product>();
    }
}